<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZenCards ‚Äî Hands-Free Flashcards (3-Day Free Trial)</title>
  <style>
    #billingModal { z-index: 10000; }
    :root{
      --bg1:#1f2937;
      --bg2:#020617;
      --card:#020617cc;
      --border:#1f2937; 
      --text:#e5e7eb;
      --muted:#9ca3af;
      --green:#10b981;
      --green2:#22c55e;
      --slate:#374151;
      --shadow: 0 18px 35px rgba(0,0,0,0.55), 0 0 0 1px rgba(15,23,42,0.7);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      padding:1rem;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, var(--bg1) 0, var(--bg2) 55%);
      color:var(--text);
      line-height:1.5;
    }
    a{color:inherit}
    .container{max-width:980px;margin:0 auto;}
    .card{
      background: var(--card);
      border-radius: 0.9rem;
      padding: 1rem;
      margin-top: 1rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .row{
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
      align-items:center;
    }
    .row > *{flex:1;min-width:260px}
    .appHeader{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:0.6rem;
      margin-top:0.25rem;
      margin-bottom:0.25rem;
    }
    .logoMark{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.95rem;
      font-weight: 800;
      letter-spacing: 0.06em;
      background: radial-gradient(circle at 30% 0%, var(--green2) 0, #22c55e22 45%, #020617 70%);
      box-shadow: 0 8px 18px rgba(15,23,42,0.9);
      color: var(--text);
      flex-shrink:0;
    }
    h1,h2,h3{margin:0.5rem 0}
    .subtitle{
      text-align:center;
      font-size:0.95rem;
      color:var(--muted);
      margin:0 0 0.75rem 0;
    }
    .hero{
      padding:1.25rem 1rem;
    }
    .hero h1{
      font-size:2rem;
      letter-spacing:0.02em;
      margin:0.25rem 0 0.5rem 0;
    }
    .hero p{
      color:var(--muted);
      margin:0.5rem 0;
      font-size:1.02rem;
    }
    .badge{
      display:inline-block;
      padding:0.2rem 0.55rem;
      border-radius:999px;
      background:#1f2937;
      font-size:0.78rem;
      color:#cbd5e1;
      border:1px solid #111827;
      margin-right:0.5rem;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:0.45rem;
      padding:0.55rem 1.2rem;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: var(--green);
      color: #020617;
      font-weight:700;
      font-size:0.98rem;
      text-decoration:none;
      box-shadow: 0 8px 18px rgba(16,185,129,0.28);
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.12s ease;
      white-space:nowrap;
    }
    .btn:hover{background:var(--green2); transform:translateY(-1px); box-shadow:0 10px 22px rgba(34,197,94,0.35);}
    .btn:active{transform:translateY(0); box-shadow:0 4px 10px rgba(15,23,42,0.6);}
    .btn.secondary{
      background: var(--slate);
      color: var(--text);
      box-shadow:none;
    }
    .btn.secondary:hover{background:#4b5563; box-shadow:0 6px 14px rgba(15,23,42,0.65);}
    .btn.small{padding:0.35rem 0.85rem; font-size:0.85rem}
    .muted{color:var(--muted)}
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:0.75rem;
    }
    @media (max-width: 860px){
      .grid3{grid-template-columns:1fr}
    }
    .feature{
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
      background:#020617;
    }
    .feature h3{margin:0 0 0.35rem 0; font-size:1rem;}
    .feature p{margin:0; color:var(--muted); font-size:0.92rem;}
    .pricing{
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
      align-items:stretch;
    }
    .pricing > *{flex:1; min-width:300px;}
    .priceCard{
      background:#020617;
      border:1px solid #111827;
      border-radius:0.9rem;
      padding:1rem;
    }
    .price{
      font-size:2rem;
      font-weight:900;
      margin:0.25rem 0;
    }
    ul{margin:0.5rem 0 0 1.15rem; color:var(--muted);}
    li{margin:0.35rem 0;}
    .fineprint{
      font-size:0.85rem;
      color:var(--muted);
      margin-top:0.75rem;
      border-top:1px solid #111827;
      padding-top:0.75rem;
    }
    /* ===== Student pain strip (goes above KPI row) ===== */
.painStrip{
  margin-top: 0.9rem;
  margin-bottom: 0.75rem;
  padding: 0.85rem;
  border-radius: 0.95rem;
  background: linear-gradient(180deg, rgba(2,6,23,0.85), rgba(2,6,23,0.65));
  border: 1px solid #111827;
}

.painTitle{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 0.75rem;
  margin: 0 0 0.65rem 0;
}

.painTitle h3{
  margin:0;
  font-size: 1.05rem;
}

.painTitle .muted{
  font-size: 0.9rem;
}

.painGrid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.75rem;
}

@media (max-width: 860px){
  .painGrid{ grid-template-columns: 1fr; }
}

.painItem{
  background:#020617;
  border:1px solid #111827;
  border-radius:0.85rem;
  padding:0.85rem;
}

.painItemTop{
  display:flex;
  align-items:center;
  gap:0.55rem;
  margin-bottom: 0.25rem;
}

.painIcon{
  width: 34px;
  height: 34px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  border:1px solid #1f2937;
  background: rgba(16,185,129,0.10);
  color: #bbf7d0;
  font-weight: 900;
  flex-shrink: 0;
}

.painItem h4{
  margin:0;
  font-size: 0.98rem;
}

.painItem p{
  margin:0.2rem 0 0 0;
  color: var(--muted);
  font-size: 0.92rem;
}

    .kpiRow{
      display:flex;
      gap:0.75rem;
      flex-wrap:wrap;
      margin-top:0.75rem;
    }
    .kpi{
      flex:1;
      min-width:240px;
      background:#020617;
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
    }
    .kpi .big{font-size:1.35rem; font-weight:900; margin:0;}
    .kpi .small{margin:0.2rem 0 0 0; color:var(--muted); font-size:0.9rem;}
    .faq details{
      background:#020617;
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
      margin-top:0.6rem;
    }
    .faq summary{
      cursor:pointer;
      font-weight:700;
    }
    .footer{
      text-align:center;
      color:var(--muted);
      font-size:0.85rem;
      margin:1.25rem 0 0.5rem 0;
    }
    .note{
      background: rgba(34,197,94,0.10);
      border: 1px solid rgba(34,197,94,0.25);
      color: #d1fae5;
      border-radius: 0.85rem;
      padding: 0.85rem;
    }
    code.inline{
      background:#111827;
      padding:0.15rem 0.4rem;
      border-radius:0.4rem;
      border:1px solid #0b1220;
      color:#cbd5e1;
      font-size:0.9em;
    }
    /* ===== When to use ZenCards (under painStrip) ===== */
.useStrip{
  margin-top: 0.75rem;
  margin-bottom: 0.75rem;
  padding: 0.85rem;
  border-radius: 0.95rem;
  background: linear-gradient(180deg, rgba(2,6,23,0.82), rgba(2,6,23,0.60));
  border: 1px solid #111827;
}

.useTitle{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 0.75rem;
  margin: 0 0 0.65rem 0;
}

.useTitle h3{
  margin:0;
  font-size: 1.05rem;
}

.useTitle p{
  margin:0.15rem 0 0 0;
  color: var(--muted);
  font-size: 0.92rem;
}

.pillRow{
  display:flex;
  flex-wrap:wrap;
  gap:0.5rem;
}

.pill{
  display:inline-flex;
  align-items:center;
  gap:0.45rem;
  padding:0.38rem 0.65rem;
  border-radius:999px;
  border:1px solid #1f2937;
  background:#020617;
  color:#cbd5e1;
  font-size:0.88rem;
  white-space:nowrap;
}

.pill .dot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(16,185,129,0.65);
  box-shadow: 0 0 0 3px rgba(16,185,129,0.10);
}


    /* ===== Login Modal ===== */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 1rem;
      z-index: 9999;
    }
    .modalOverlay.show{display:flex;}
    .modal{
      width: 100%;
      max-width: 440px;
      background: #020617;
      border: 1px solid #111827;
      border-radius: 1rem;
      box-shadow: var(--shadow);
      padding: 1rem;
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 0.75rem;
    }
    .modalHeader h3{margin:0.25rem 0;}
    .modalClose{
      background: transparent;
      border: 1px solid #1f2937;
      color: var(--text);
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      cursor:pointer;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:0.35rem;
      margin-top: 0.75rem;
    }
    .input{
      width: 100%;
      padding: 0.65rem 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      background: #0b1220;
      color: var(--text);
      outline: none;
    }
    .input:focus{
      border-color: rgba(34,197,94,0.55);
      box-shadow: 0 0 0 3px rgba(34,197,94,0.12);
    }
    .modalActions{
      display:flex;
      gap:0.75rem;
      align-items:center;
      margin-top: 1rem;
    }
    .modalMsg{
      margin-top: 0.75rem;
      color: var(--muted);
      font-size: 0.9rem;
      word-break: break-word;
    }
    .modalMsg.error{color:#fecaca;}
    .modalMsg.ok{color:#bbf7d0;}
    .smallLink{
      color: #cbd5e1;
      font-size: 0.9rem;
      text-decoration: underline;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="appHeader">
      <div class="logoMark">Z</div>
      <h2 style="margin:0;">ZenCards</h2>
    </div>
    <p class="subtitle">Hands-free & silent spaced-repetition flashcards</p>

    <!-- HERO -->
    <div class="card hero">
      <span class="badge">3-Day Free Trial</span>
      <span class="badge">$9.99/month</span>

      <h1>Saving money and time as a student is easier than ever with ZenCards: The world's first study tool designed specifically for fully hands and eyes-free studying on the go.</h1>
      <p>
        Busy and goal oriented students have little time to spare when balancing studying with work, <strong>until now</strong>. ZenCards lets you study your flashcards completely hands-free <strong>without looking at your phone</strong>.
        Review while doing everyday activities so you can turn unproductive "dead" time into high quality review time, freeing up your schedule for a full time job as a student so you can invest in your future upon graduation. 
      </p>
      <!-- ===== Student pain strip (NEW) ===== -->
<div class="painStrip">
  <div class="painTitle">
    <h3>The student trap: Either grades, finances, or your social life suffers</h3>
    <div class="muted"></div>
  </div>

  <div class="painGrid">
    <div class="painItem">
      <div class="painItemTop">
        <div class="painIcon">‚è±</div>
        <h4>Grades slip</h4>
      </div>
      <p>In working a full time job and maintaining a social life, there‚Äôs often not enough time to study, so performance drops and post-graduation opportunities close, limiting your options and wasting your educational opportunity.</p>
    </div>

    <div class="painItem">
      <div class="painItemTop">
        <div class="painIcon">üí∏</div>
        <h4>Money stays tight</h4>
      </div>
      <p>In prioritizing studying and relationships over work, studying eats your schedule, leaving little time to work, save, and build wealth early in life when it is most beneficial to be doing so to prevent financial stagnation early and ultimately later in life.</p>
    </div>

    <div class="painItem">
      <div class="painItemTop">
        <div class="painIcon">üò∂</div>
        <h4>No free time</h4>
      </div>
      <p>School + work kills your social life, causing loneliness, burnout, stress, and unhappiness. Working as a student does not need to feature sacrificing your social life.</p>
    </div>
  </div>
</div>
<!-- ===== When to use ZenCards (NEW) ===== -->
<div class="useStrip">
  <div class="useTitle">
    <div>
      <h3>Use ZenCards anywhere</h3>
      <p>We designed ZenCards to work in <strong>any</strong> setting ‚Äî so you can study whenever life happens.</p>
    </div>
    <div class="muted" style="font-size:0.9rem;">If you can listen, you can review.</div>
  </div>

  <div class="pillRow">
    <span class="pill"><span class="dot"></span>Commuting</span>
    <span class="pill"><span class="dot"></span>Walking to class</span>
    <span class="pill"><span class="dot"></span>Eating</span>
    <span class="pill"><span class="dot"></span>Between lectures</span>
    <span class="pill"><span class="dot"></span>In class (silent mode)</span>
    <span class="pill"><span class="dot"></span>Doing chores</span>
    <span class="pill"><span class="dot"></span>At the gym</span>
    <span class="pill"><span class="dot"></span>Waiting in line</span>
    <span class="pill"><span class="dot"></span>Anywhere you have 2 minutes</span>
  </div>
</div>


      <div class="kpiRow">
        <div class="kpi">
          <p class="big">Roughly 3 hours/day</p>
          <p class="small">Saved by converting downtime into review time.</p>
        </div>
        <div class="kpi">
          <p class="big">‚âà 33¬¢/day</p>
          <p class="small">$9.99/month for a massive upgrade in the student lifestyle experience and bolstered memory retention.</p>
        </div>
        <div class="kpi">
          <p class="big">Hands-free + Silent</p>
          <p class="small">Choose audio mode or traditional flashcards depending on your setting and current activity.</p>
        </div>
      </div>

      <div class="row" style="margin-top:0.85rem;">
  <button class="btn secondary" id="loginBtn" type="button">Log in</button>
  <a class="btn secondary small" href="mailto:support@YOURDOMAIN.com?subject=ZenCards%20Cancel%20Subscription">Manage / Cancel subscription</a>
</div>

      <!-- ===== Account + Gate (Landing Page) ===== -->
<div class="card" style="margin-top:1rem;background:#0b1220;border:1px solid #111827;">
  <div class="row" style="align-items:center;">
    <div style="flex:2;min-width:260px;">
      <h3 style="margin:0;">Account</h3>
      <div id="lpWhoami" class="muted" style="margin-top:0.25rem;">Not logged in</div>
      <div id="lpStatus" class="muted" style="margin-top:0.25rem;"></div>
    </div>

    <div style="display:flex;gap:0.6rem;justify-content:flex-end;flex:1;min-width:260px;">
      <button class="btn secondary small" id="lpLogoutBtn" type="button" style="display:none;">Log out</button>

      <button class="btn" id="lpGoBtn" type="button" disabled
        style="background:#334155;color:#94a3b8;box-shadow:none;cursor:not-allowed;">
        Go to ZenCards (locked)
      </button>
    </div>
  </div>
</div>


      <div class="fineprint">
        <strong>Billing:</strong> Your 3-day free trial starts when you create an account.
        You will be <strong>charged $9.99/month automatically</strong> at the end of the trial unless you cancel beforehand.
        Cancel anytime from the ‚ÄúManage / Cancel subscription‚Äù option.
      </div>
    </div>

    <!-- BENEFITS -->
    <div class="card">
      <h2>Why ZenCards works</h2>
      <div class="grid3">
        <div class="feature">
          <h3>Save time</h3>
          <p>
            The most significant source of unproductive time for students is time we all spend doing everyday activities, such as commuting, walking, exercising, eating, chores, waiting in lines, sitting in that one class you needed to take for your art requirement, etc. ZenCards turns that into productive study time so you don't need to dedicate your valuable hours to review. 
        </div>
        <div class="feature">
          <h3>More freedom outside school</h3>
          <p>
            An extra few hours every day gives you the time to fully commit to a sport or club, giving you a massive advantage over the competition and enabling you to pursue an athletic career post graduation. Working full time as a student is easier than ever allowing you to save and invest early, setting you up for financial freedom sooner in life. 
          </p>
        </div>
        <div class="feature">
          <h3>Better memory with audio + speaking</h3>
          <p>
            Hearing information and saying answers out loud boosts recall (often called the <em>production effect</em>).
            Seeing + hearing together supports <em>dual coding</em> so the same study time goes further as well, making zencards effective for when you want to focus solely on studying and when you are on the go.
          </p>
        </div>
      </div>

      <div class="grid3" style="margin-top:0.75rem;">
        <div class="feature">
          <h3>Spaced repetition built in</h3>
          <p>
            ZenCards schedules reviews so you see cards again right before you forget ‚Äî the core idea behind spaced repetition.
            You waste less time re-studying what you already know.
          </p>
        </div>
        <div class="feature">
          <h3>Raise grades ‚Üí open doors</h3>
          <p>
            Better retention can translate to better exam performance ‚Äî helping you compete for internships,
            grad school admissions, and stronger early-career opportunities, as well as scholarships, preventing you from crippling debt impairing you financially later in life. 
          </p>
        </div>
        <div class="feature">
          <h3>Works everywhere</h3>
          <p>
            Study in the car (passenger), walking to class, at the gym between sets, running errands, or between lectures.
            If you can listen, you can review. 
          </p>
        </div>
      </div>
    </div>

    <!-- HOW IT WORKS -->
    <div class="card">
      <h2>How it works</h2>
      <div class="row">
        <div>
          <h3 style="margin-top:0;">1) Add cards</h3>
          <p class="muted">
            Create decks, add questions + answers, or import from Anki.
            (You can also include images + math.)
          </p>

          <h3>2) Choose your study style</h3>
          <p class="muted" style="margin-bottom:0.35rem;">
            ZenCards supports multiple hands-free behaviors through the use of Text-to-speech and responds to spoken commands when answering, as well as spaced repetition scheduling to prioritize information you don't currently know over things you have mastered. ZenCards uses your spoken difficulty ratings to determine when you will see your cards again.
          </p>
          <ul>
            <li><strong>Play answer after you speak</strong> (hands and eyes-free flow)</li>
            <li><strong>Play answer after X seconds, perfect for studying in discreet settings. </strong> (timed flow)</li>
            <li><strong>Study-ahead mode</strong>: keep going through the deck without changing your schedule, perfect for cramming the night before an exam with no time to study.</li>
          </ul>
        </div>

        <div>
          <h3 style="margin-top:0;">3) Rate the card (spaced repetition)</h3>
          <p class="muted">
            After you see the answer, you rate it:
            <strong>Again / Hard / Good / Easy, entirely with your voice commands.</strong>. ZenCards uses that rating to schedule when you see it next.
             <li><strong>Automatic mode</strong>: auto-assign the same rating to every card (no voice commands needed)</li>
          </p>

          <div class="note" style="margin-top:0.75rem;">
            <strong>Pro tip:</strong> Use hands-free mode while moving, then do quick silent sessions when you‚Äôre sitting.
            Same decks, same progress.
          </div>
        </div>
      </div>
    </div>

    <!-- PRICING -->
    <div class="card">
      <h2>Pricing</h2>
      <div class="pricing">
        <div class="priceCard">
          <span class="badge">Most popular</span>
          <h3 style="margin:0.35rem 0 0 0;">ZenCards Premium</h3>
          <p class="price">$9.99<span style="font-size:0.9rem;font-weight:700;color:var(--muted);">/month</span></p>
          <p class="muted" style="margin-top:0.25rem;">
            Start with a <strong>3-day free trial</strong>, then auto-renews monthly.
          </p>
          <ul>
            <li>Hands-free voice study</li>
            <li>Timed answer mode</li>
            <li>Automatic rating mode</li>
            <li>Study-ahead mode</li>
            <li>Deck + card editor</li>
            <li>Anki import support</li>
          </ul>

          <div class="row" style="margin-top:0.85rem;">
  <button class="btn" id="startTrialBtn" type="button">Start free trial</button>
</div>

          <div class="fineprint">
            <strong>Auto-billing notice:</strong> After 7 days, you will be charged $9.99/month unless you cancel.
            Cancel anytime before the trial ends to avoid being charged.
          </div>
        </div>

        <div class="priceCard">
          <h3 style="margin-top:0.35rem;">Cancel anytime</h3>
          <p class="muted">
            We keep cancellation simple. Use the manage/ cancel subscription button at the top of this screen or manage billing while on the studying screen to cancel any time. No hoops, no hard feelings.
          </p>

          <div class="fineprint">
            <strong>Note:</strong> If you have any questions, feel more than free to reach out to support@zencardstudy.com and our group will get back to you promptly. 
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="card faq">
      <h2>FAQ</h2>

      <details>
        <summary>Will I be charged automatically after the free trial?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Yes. Your trial lasts 3 days. If you don‚Äôt cancel before it ends, your subscription will begin at
          <strong>$9.99/month</strong> and renew automatically each month until you cancel.
        </p>
      </details>

      <details>
        <summary>How do I cancel?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          You‚Äôll cancel from the ‚ÄúManage / Cancel subscription‚Äù link (Stripe customer portal) once billing is connected.
        </p>
      </details>

      <details>
        <summary>Can I study on my phone and on the website with one subscription?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Yes ‚Äî one account, one subscription. Log in with the same email and your access follows your account.
        </p>
      </details>

      <details>
        <summary>What‚Äôs spaced repetition?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Spaced repetition is a study method where you review information at increasing intervals,
          timed around when you‚Äôre most likely to forget. It‚Äôs designed to maximize long-term retention
          while minimizing wasted review time.
        </p>
      </details>

      <details>
        <summary>What are ‚Äúproduction effect‚Äù and ‚Äúdual coding‚Äù?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          In simple terms: memory is stronger when you engage multiple channels.
          Speaking responses out loud can reinforce recall (often referred to as the production effect),
          and combining visual + audio supports dual coding ‚Äî giving your brain more ‚Äúhandles‚Äù to retrieve the info later.
        </p>
      </details>
    </div>

    <p class="footer">
      ¬© <span id="year"></span> ZenCards ‚Ä¢ <span class="muted">Study smarter. Live more.</span>
    </p>
  </div>

  <!-- ===== Login Modal (MOVED ABOVE SCRIPTS so JS can find it) ===== -->
  <div class="modalOverlay" id="loginModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="modalHeader">
        <div>
          <h3 id="loginTitle">Log in</h3>
          <div class="muted" style="font-size:0.9rem;">Enter your ZenCards email + password.</div>
        </div>
        <button class="modalClose" id="loginCloseBtn" type="button">‚úï</button>
      </div>

      <div class="field">
        <label class="muted" for="loginEmail">Email</label>
        <input class="input" id="loginEmail" type="email" autocomplete="email" placeholder="you@example.com" />
      </div>

      <div class="field">
        <label class="muted" for="loginPassword">Password</label>
        <input class="input" id="loginPassword" type="password" autocomplete="current-password" placeholder="Your password" />
      </div>

      <div class="modalActions">
        <button class="btn" id="loginSubmitBtn" type="button">Log in</button>
        <button class="btn secondary" id="loginCancelBtn" type="button">Cancel</button>
      </div>

      <div class="modalMsg" id="loginMsg"></div>

      <div style="margin-top:0.75rem; display:flex; justify-content:space-between; gap:12px;">
  <button class="smallLink" id="forgotPwBtn" type="button">Forgot password?</button>
  <button class="smallLink" id="toggleAuthModeBtn" type="button">Create account</button>
</div>
    </div>
  </div>

  <!-- ===== Billing Modal (shown after login if no subscription yet) ===== -->
<div class="modalOverlay" id="billingModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="billingTitle">
    <div class="modalHeader">
      <div>
        <h3 id="billingTitle">ZenCards Premium</h3>
        <div class="muted" style="font-size:0.9rem;">
          Your account is ready. Continue to Stripe to start your free trial.
        </div>
      </div>
      <button class="modalClose" id="billingCloseBtn" type="button">‚úï</button>
    </div>

    <div class="modalActions" style="margin-top:1rem;">
      <button class="btn" id="continueToBillingBtn" type="button">Continue to billing</button>
      <button class="btn secondary" id="billingCancelBtn" type="button">Cancel</button>
    </div>

    <div class="modalMsg" id="billingMsg"></div>
  </div>
</div>


  <script>
    // Year (keep only one)
    document.getElementById("year").textContent = String(new Date().getFullYear());

    // ===== Supabase client (same anon key as app.html) =====
    const SUPABASE_URL = "https://elpfcnnrripftxoqeckv.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVscGZjbm5ycmlwZnR4b3FlY2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NTk5MzQsImV4cCI6MjA4MDQzNTkzNH0.uiLHVcRfMXu0V7QRW41TARMIy-Hbhovc4h9uYFzzGLQ";
    const { createClient } = window.supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    storage: window.localStorage,
  },
});
// ===== Landing Page Gate UI =====
const lpWhoami = document.getElementById("lpWhoami");
const lpStatus = document.getElementById("lpStatus");
const lpGoBtn = document.getElementById("lpGoBtn");
const lpLogoutBtn = document.getElementById("lpLogoutBtn");

function setLpGoButton(unlocked) {
  if (unlocked) {
    lpGoBtn.disabled = false;
    lpGoBtn.textContent = "Go to ZenCards";
    lpGoBtn.style.background = "var(--green)";
    lpGoBtn.style.color = "#020617";
    lpGoBtn.style.cursor = "pointer";
    lpGoBtn.style.boxShadow = "0 8px 18px rgba(16,185,129,0.28)";
  } else {
    lpGoBtn.disabled = true;
    lpGoBtn.textContent = "Go to ZenCards (locked)";
    lpGoBtn.style.background = "#334155";
    lpGoBtn.style.color = "#94a3b8";
    lpGoBtn.style.cursor = "not-allowed";
    lpGoBtn.style.boxShadow = "none";
  }
}
async function waitForAccess({ maxMs = 30000, intervalMs = 1500 } = {}) {
  const start = Date.now();
  while (Date.now() - start < maxMs) {
    try { await supabaseClient.auth.refreshSession(); } catch (_) {}

    const access = await checkUserAccess();
    if (access?.hasAccess) return true;

    await new Promise(r => setTimeout(r, intervalMs));
  }
  return false;
}

async function refreshLandingGate() {
  const { data: userData, error: userErr } = await supabaseClient.auth.getUser();
  const user = userData?.user || null;

  if (userErr) console.warn("[refreshLandingGate] getUser error:", userErr);

  if (!user) {
    lpWhoami.textContent = "Not logged in";
    lpStatus.textContent = "";
    lpLogoutBtn.style.display = "none";
    setLpGoButton(false);
    return;
  }

  lpWhoami.textContent = `Logged in as: ${user.email || user.id}`;
  lpLogoutBtn.style.display = "inline-flex";

    lpStatus.textContent = "Checking access‚Ä¶";
  let access = await checkUserAccess(user.id);

  // If they just came back from Stripe, wait a bit for webhook/DB update
  const params = new URLSearchParams(window.location.search);
  const cameFromStripe = params.has("success") || params.has("session_id");

  if (!access?.hasAccess && cameFromStripe) {
    lpStatus.textContent = "Finishing setup‚Ä¶ (this can take a few seconds)";
    const ok = await waitForAccess({ maxMs: 30000, intervalMs: 1500 });
    if (ok) access = await checkUserAccess(user.id);

    // Optional: clean the URL so refresh doesn't keep polling
    history.replaceState({}, document.title, window.location.pathname);
  }

  // Show status info
  if (access?.rows?.length) {
    const statuses = access.rows.map(r => String(r.status || "").toLowerCase()).join(", ");
    lpStatus.textContent = `Subscription status: ${statuses || "(none)"}`;
  } else {
    lpStatus.textContent = access?.hasAccess ? "Subscription status: ok" : "No active/trial subscription found.";
  }

  setLpGoButton(!!access?.hasAccess);
}

lpGoBtn?.addEventListener("click", async () => {
  // safety re-check on click
  const { data } = await supabaseClient.auth.getUser();
  const user = data?.user;
  if (!user) return;

  const access = await checkUserAccess(user.id);
  if (!access?.hasAccess) return;

  window.location.href = "https://zencardstudy.com/app.html";
});

lpLogoutBtn?.addEventListener("click", async () => {
  await supabaseClient.auth.signOut();
  await refreshLandingGate();
});

// Keep UI in sync when auth changes
supabaseClient.auth.onAuthStateChange(() => {
  refreshLandingGate();
});

// Initial draw
refreshLandingGate();


async function checkUserAccess(userIdFromLogin) {
  // Prefer uid from login response
  let uid = userIdFromLogin;

  // Fallback to current session user
  if (!uid) {
    const { data: userData, error: userErr } = await supabaseClient.auth.getUser();
    console.log("[checkUserAccess] getUser:", { userErr, user: userData?.user });
    uid = userData?.user?.id;
  }

  if (!uid) return { hasAccess: false, reason: "not_logged_in" };

  // IMPORTANT: order by a column that exists.
  // Most tables have "id". If yours doesn't, see Step 2 below.
 const { data, error, status } = await supabaseClient
  .from("subscriptions")
  .select("status,user_id,stripe_subscription_id")
  .eq("user_id", uid);

const safe = {
  uid,
  statusCode: status,
  error: error ? { message: error.message, code: error.code, details: error.details, hint: error.hint } : null,
  rows: Array.isArray(data) ? data : null,
};
console.log("[checkUserAccess] subscriptions raw:", safe);

if (error) {
  return { hasAccess: false, reason: "subs_read_failed", error: error.message };
}

const hasAccess =
  Array.isArray(data) &&
  data.some(r => ["active", "trialing"].includes(String(r?.status || "").toLowerCase()));

return { hasAccess, reason: hasAccess ? "ok" : "no_active_or_trialing_row", rows: data || [] };
}
    
    // Expose it on window so it's not "undefined" in console
window.startFreeTrial = async function startFreeTrial() {
  const authKey = Object.keys(localStorage).find(k => k.endsWith("-auth-token"));
  const raw = authKey ? localStorage.getItem(authKey) : null;
  const session = raw ? JSON.parse(raw) : null;

  // If already logged in, start Stripe checkout immediately
  if (session?.access_token) {
  const access = await checkUserAccess();
  if (access.hasAccess) {
    window.location.href = "app.html";
    return;
  }
  await startCheckoutFromLanding();
  return;
}

  // Otherwise open SIGNUP modal (create account)
openLoginModal("signup");
};

    // ===== Login modal logic =====
    const loginModal = document.getElementById("loginModal");
    const loginBtn = document.getElementById("loginBtn");
    const loginCloseBtn = document.getElementById("loginCloseBtn");
    const loginCancelBtn = document.getElementById("loginCancelBtn");
    const loginSubmitBtn = document.getElementById("loginSubmitBtn");
    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginMsg = document.getElementById("loginMsg");
    const forgotPwBtn = document.getElementById("forgotPwBtn");
    const toggleAuthModeBtn = document.getElementById("toggleAuthModeBtn");

let authMode = "login"; // "login" | "signup"

function setAuthMode(mode) {
  authMode = mode;

  const titleEl = document.getElementById("loginTitle");
  const subtitleEl = titleEl?.nextElementSibling; // the small muted text under title (in your HTML)

  if (mode === "signup") {
    titleEl.textContent = "Create account";
    if (subtitleEl) subtitleEl.textContent = "Enter an email + password. We'll email you a confirmation link.";
    loginSubmitBtn.textContent = "Create account";
    forgotPwBtn.style.display = "none";
    if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = "Already have an account? Log in";
  } else {
    titleEl.textContent = "Log in";
    if (subtitleEl) subtitleEl.textContent = "Enter your ZenCards email + password.";
    loginSubmitBtn.textContent = "Log in";
    forgotPwBtn.style.display = "inline-block";
    if (toggleAuthModeBtn) toggleAuthModeBtn.textContent = "Create account";
  }
}
toggleAuthModeBtn?.addEventListener("click", () => {
  setAuthMode(authMode === "login" ? "signup" : "login");
});


        // ===== Billing modal logic =====
    const billingModal = document.getElementById("billingModal");
    const billingCloseBtn = document.getElementById("billingCloseBtn");
    const continueToBillingBtn = document.getElementById("continueToBillingBtn");
    const billingCancelBtn = document.getElementById("billingCancelBtn");
    const billingMsg = document.getElementById("billingMsg");

    function openBillingModal(){
      billingMsg.textContent = "";
      billingMsg.className = "modalMsg";
      billingModal.classList.add("show");
    }
    function closeBillingModal(){
      billingModal.classList.remove("show");
    }

    billingCloseBtn.addEventListener("click", closeBillingModal);
    billingCancelBtn.addEventListener("click", async () => {
      // Optional but recommended: sign out so they don't sit logged-in with no access
      try { await supabaseClient.auth.signOut(); } catch(e) {}
      closeBillingModal();
      window.location.href = "/"; // back to landing
    });

    // close modal if click outside
    billingModal.addEventListener("click", (e) => {
      if (e.target === billingModal) closeBillingModal();
    });

window.addEventListener("unhandledrejection", (e) => {
  console.error("[unhandledrejection]", e.reason);
});
window.addEventListener("error", (e) => {
  console.error("[window error]", e.message, e.error);
});

    continueToBillingBtn.addEventListener("click", async () => {
      console.log("[Billing] click fired");
console.log("[Billing] about to call startCheckoutFromLanding");
setTimeout(() => console.log("[Billing] still running after 5s"), 5000);
      continueToBillingBtn.disabled = true;
      continueToBillingBtn.textContent = "Redirecting‚Ä¶";
      billingMsg.textContent = "";

      try {
        await startCheckoutFromLanding();
      } catch (e) {
        console.error(e);
        billingMsg.textContent = "Could not start billing. Check console.";
        billingMsg.className = "modalMsg error";
        continueToBillingBtn.disabled = false;
        continueToBillingBtn.textContent = "Continue to billing";
      }
    });

    function openLoginModal(mode = "login"){
  setAuthMode(mode);
  loginMsg.textContent = "";
  loginMsg.className = "modalMsg";
  loginModal.classList.add("show");
  setTimeout(() => loginEmail.focus(), 50);
}
    function closeLoginModal(){
      loginModal.classList.remove("show");
    }

    loginBtn?.addEventListener("click", openLoginModal);
    loginCloseBtn.addEventListener("click", closeLoginModal);
    loginCancelBtn.addEventListener("click", closeLoginModal);

    // close modal if click outside
    loginModal.addEventListener("click", (e) => {
      if (e.target === loginModal) closeLoginModal();
    });

    // Enter-to-submit
    [loginEmail, loginPassword].forEach(el => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter") loginSubmitBtn.click();
        if (e.key === "Escape") closeLoginModal();
      });
    });

    loginSubmitBtn.addEventListener("click", async () => {
      const email = (loginEmail.value || "").trim();
      const password = loginPassword.value || "";

      if (!email || !password) {
        loginMsg.textContent = "Please enter your email and password.";
        loginMsg.className = "modalMsg error";
        return;
      }

      loginSubmitBtn.disabled = true;
      loginSubmitBtn.textContent = "Logging in‚Ä¶";
      loginMsg.textContent = "";

      try {
  if (authMode === "signup") {
    // Create account + send confirmation email
    const res = await supabaseClient.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: "https://zencardstudy.com/confirm.html"
      }
    });
    console.log("[SIGNUP RESULT]", res);

    if (res.error) {
      loginMsg.textContent = res.error.message;
      loginMsg.className = "modalMsg error";
      return;
    }

    loginMsg.textContent = "Account created ‚úÖ Check your email to confirm, then you'll be sent to Stripe.";
    loginMsg.className = "modalMsg ok";

    // Optional safety: close modal so user doesn‚Äôt keep clicking
    // closeLoginModal();

    return; // IMPORTANT: do NOT start Stripe here; wait for confirmation link
  }

  // ===== LOGIN MODE (your existing behavior) =====
  const res = await supabaseClient.auth.signInWithPassword({ email, password });
  console.log("[LOGIN RESULT]", res);

  if (res.error) {
    loginMsg.textContent = res.error.message;
    loginMsg.className = "modalMsg error";
    return;
  }

  loginMsg.textContent = "Logged in ‚úÖ";
  loginMsg.className = "modalMsg ok";
  closeLoginModal();

  const uid = res?.data?.user?.id;
  const access = await checkUserAccess(uid);

  if (access?.hasAccess === true || access?.hasAccess === "true") {
    await refreshLandingGate();
    return;
  }

  await startCheckoutFromLanding();
} catch (e) {
  console.error(e);
  loginMsg.textContent = "Something went wrong. Check console.";
  loginMsg.className = "modalMsg error";
}
    });

    forgotPwBtn.addEventListener("click", async () => {
      const email = (loginEmail.value || "").trim();
      if (!email) {
        loginMsg.textContent = "Enter your email above first, then click ‚ÄúForgot password?‚Äù.";
        loginMsg.className = "modalMsg error";
        return;
      }

      try {
        const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
          redirectTo: "https://zencardstudy.com/reset.html"
        });
        if (error) {
          loginMsg.textContent = error.message || "Could not send reset email.";
          loginMsg.className = "modalMsg error";
          return;
        }
        loginMsg.textContent = "Password reset email sent ‚úÖ";
        loginMsg.className = "modalMsg ok";
      } catch (e) {
        console.error(e);
        loginMsg.textContent = "Reset failed. Check console.";
        loginMsg.className = "modalMsg error";
      }
    });
    
async function startCheckoutFromLanding() {
  console.log("[startCheckoutFromLanding] starting‚Ä¶");

  const { data: sessionData, error: sessionErr } = await supabaseClient.auth.getSession();
  if (sessionErr) console.warn("[getSession error]", sessionErr);

  const token = sessionData?.session?.access_token;
  console.log("[startCheckoutFromLanding] has token:", !!token);

  if (!token) throw new Error("No session token found. Please log in again.");

  const res = await fetch(
    "https://elpfcnnrripftxoqeckv.supabase.co/functions/v1/create-checkout-session",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`,
        "apikey": SUPABASE_ANON_KEY,
      },
      body: JSON.stringify({
       success_url: "https://zencardstudy.com/?success=1&session_id={CHECKOUT_SESSION_ID}",
cancel_url:  "https://zencardstudy.com/?canceled=1",
      }),
    }
  );

  const json = await res.json().catch(() => ({}));
  console.log("[startCheckoutFromLanding] status:", res.status, json);

  if (!res.ok) throw new Error(json.error || json.message || "Checkout failed");
  if (!json.url) throw new Error("No checkout URL returned from Edge Function");

  window.location.href = json.url; // ‚úÖ redirect to Stripe
}

(async () => {
  await refreshLandingGate();
})();

  document.getElementById("startTrialBtn")
  .addEventListener("click", () => window.startFreeTrial());
  </script>

</body>
</html>
