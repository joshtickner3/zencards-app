<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZenCards — Hands-Free Flashcards (7-Day Free Trial)</title>
  <style>
    /* ===== Logged-in status bar ===== */
#authStatusBar{
  position: sticky;
  top: 0;
  z-index: 10002; /* above modals */
  background: #020617;
  border-bottom: 1px solid #1f2937;
  display: none; /* hidden until logged in */
}
#authStatusInner{
  max-width: 980px;
  margin: 0 auto;
  padding: 0.6rem 1rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 0.75rem;
  color:#cbd5e1;
  font-size:0.9rem;
}
#authEmail{
  font-weight:700;
}
#logoutBtn{
  background: transparent;
  border: 1px solid #374151;
  color: #e5e7eb;
  border-radius: 999px;
  padding: 0.25rem 0.7rem;
  cursor: pointer;
  font-size: 0.85rem;
}
#logoutBtn:hover{
  background:#1f2937;
}

    #billingModal { z-index: 10000; }
    :root{
      --bg1:#1f2937;
      --bg2:#020617;
      --card:#020617cc;
      --border:#1f2937;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --green:#10b981;
      --green2:#22c55e;
      --slate:#374151;
      --shadow: 0 18px 35px rgba(0,0,0,0.55), 0 0 0 1px rgba(15,23,42,0.7);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      padding:1rem;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, var(--bg1) 0, var(--bg2) 55%);
      color:var(--text);
      line-height:1.5;
    }
    a{color:inherit}
    .container{max-width:980px;margin:0 auto;}
    .card{
      background: var(--card);
      border-radius: 0.9rem;
      padding: 1rem;
      margin-top: 1rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .row{
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
      align-items:center;
    }
    .row > *{flex:1;min-width:260px}
    .appHeader{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:0.6rem;
      margin-top:0.25rem;
      margin-bottom:0.25rem;
    }
    .logoMark{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.95rem;
      font-weight: 800;
      letter-spacing: 0.06em;
      background: radial-gradient(circle at 30% 0%, var(--green2) 0, #22c55e22 45%, #020617 70%);
      box-shadow: 0 8px 18px rgba(15,23,42,0.9);
      color: var(--text);
      flex-shrink:0;
    }
    h1,h2,h3{margin:0.5rem 0}
    .subtitle{
      text-align:center;
      font-size:0.95rem;
      color:var(--muted);
      margin:0 0 0.75rem 0;
    }
    .hero{
      padding:1.25rem 1rem;
    }
    .hero h1{
      font-size:2rem;
      letter-spacing:0.02em;
      margin:0.25rem 0 0.5rem 0;
    }
    .hero p{
      color:var(--muted);
      margin:0.5rem 0;
      font-size:1.02rem;
    }
    .badge{
      display:inline-block;
      padding:0.2rem 0.55rem;
      border-radius:999px;
      background:#1f2937;
      font-size:0.78rem;
      color:#cbd5e1;
      border:1px solid #111827;
      margin-right:0.5rem;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:0.45rem;
      padding:0.55rem 1.2rem;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: var(--green);
      color: #020617;
      font-weight:700;
      font-size:0.98rem;
      text-decoration:none;
      box-shadow: 0 8px 18px rgba(16,185,129,0.28);
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.12s ease;
      white-space:nowrap;
    }
    .btn:hover{background:var(--green2); transform:translateY(-1px); box-shadow:0 10px 22px rgba(34,197,94,0.35);}
    .btn:active{transform:translateY(0); box-shadow:0 4px 10px rgba(15,23,42,0.6);}
    .btn.secondary{
      background: var(--slate);
      color: var(--text);
      box-shadow:none;
    }
    .btn.secondary:hover{background:#4b5563; box-shadow:0 6px 14px rgba(15,23,42,0.65);}
    .btn.small{padding:0.35rem 0.85rem; font-size:0.85rem}
    .muted{color:var(--muted)}
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:0.75rem;
    }
    @media (max-width: 860px){
      .grid3{grid-template-columns:1fr}
    }
    .feature{
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
      background:#020617;
    }
    .feature h3{margin:0 0 0.35rem 0; font-size:1rem;}
    .feature p{margin:0; color:var(--muted); font-size:0.92rem;}
    .pricing{
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
      align-items:stretch;
    }
    .pricing > *{flex:1; min-width:300px;}
    .priceCard{
      background:#020617;
      border:1px solid #111827;
      border-radius:0.9rem;
      padding:1rem;
    }
    .price{
      font-size:2rem;
      font-weight:900;
      margin:0.25rem 0;
    }
    ul{margin:0.5rem 0 0 1.15rem; color:var(--muted);}
    li{margin:0.35rem 0;}
    .fineprint{
      font-size:0.85rem;
      color:var(--muted);
      margin-top:0.75rem;
      border-top:1px solid #111827;
      padding-top:0.75rem;
    }
    .kpiRow{
      display:flex;
      gap:0.75rem;
      flex-wrap:wrap;
      margin-top:0.75rem;
    }
    .kpi{
      flex:1;
      min-width:240px;
      background:#020617;
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
    }
    .kpi .big{font-size:1.35rem; font-weight:900; margin:0;}
    .kpi .small{margin:0.2rem 0 0 0; color:var(--muted); font-size:0.9rem;}
    .faq details{
      background:#020617;
      border:1px solid #111827;
      border-radius:0.85rem;
      padding:0.85rem;
      margin-top:0.6rem;
    }
    .faq summary{
      cursor:pointer;
      font-weight:700;
    }
    .footer{
      text-align:center;
      color:var(--muted);
      font-size:0.85rem;
      margin:1.25rem 0 0.5rem 0;
    }
    .note{
      background: rgba(34,197,94,0.10);
      border: 1px solid rgba(34,197,94,0.25);
      color: #d1fae5;
      border-radius: 0.85rem;
      padding: 0.85rem;
    }
    code.inline{
      background:#111827;
      padding:0.15rem 0.4rem;
      border-radius:0.4rem;
      border:1px solid #0b1220;
      color:#cbd5e1;
      font-size:0.9em;
    }

    /* ===== Login Modal ===== */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 1rem;
      z-index: 9999;
    }
    .modalOverlay.show{display:flex;}
    .modal{
      width: 100%;
      max-width: 440px;
      background: #020617;
      border: 1px solid #111827;
      border-radius: 1rem;
      box-shadow: var(--shadow);
      padding: 1rem;
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 0.75rem;
    }
    .modalHeader h3{margin:0.25rem 0;}
    .modalClose{
      background: transparent;
      border: 1px solid #1f2937;
      color: var(--text);
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      cursor:pointer;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:0.35rem;
      margin-top: 0.75rem;
    }
    .input{
      width: 100%;
      padding: 0.65rem 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      background: #0b1220;
      color: var(--text);
      outline: none;
    }
    .input:focus{
      border-color: rgba(34,197,94,0.55);
      box-shadow: 0 0 0 3px rgba(34,197,94,0.12);
    }
    .modalActions{
      display:flex;
      gap:0.75rem;
      align-items:center;
      margin-top: 1rem;
    }
    .modalMsg{
      margin-top: 0.75rem;
      color: var(--muted);
      font-size: 0.9rem;
      word-break: break-word;
    }
    .modalMsg.error{color:#fecaca;}
    .modalMsg.ok{color:#bbf7d0;}
    .smallLink{
      color: #cbd5e1;
      font-size: 0.9rem;
      text-decoration: underline;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
    }
  </style>
</head>

<body>
  <!-- ===== Logged-in status bar ===== -->
<div id="authStatusBar">
  <div id="authStatusInner">
    <span id="authEmail"></span>
    <button id="logoutBtn" type="button">Log out</button>
  </div>
</div>

  <div class="container">

    <div class="appHeader">
      <div class="logoMark">Z</div>
      <h2 style="margin:0;">ZenCards</h2>
    </div>
    <p class="subtitle">Hands-free & silent spaced-repetition flashcards</p>

    <!-- HERO -->
    <div class="card hero">
      <span class="badge">7-Day Free Trial</span>
      <span class="badge">$9.99/month</span>

      <h1>Turn “dead time” into 2–3 extra hours of study — every day.</h1>
      <p>
        ZenCards lets you study your flashcards <strong>without looking at your phone</strong>.
        Review while walking to class, driving, at the gym, running errands, between lectures, or even when you’re out with friends.
      </p>

      <div class="kpiRow">
        <div class="kpi">
          <p class="big">2–3 hours/day</p>
          <p class="small">Saved by converting downtime into review time.</p>
        </div>
        <div class="kpi">
          <p class="big">≈ 33¢/day</p>
          <p class="small">$9.99/month for more time + higher quality repetition.</p>
        </div>
        <div class="kpi">
          <p class="big">Hands-free + Silent</p>
          <p class="small">Choose audio mode or study-ahead reading mode.</p>
        </div>
      </div>

      <div class="row" style="margin-top:0.85rem;">
        <button class="btn" id="startTrialBtn" type="button">Start free trial</button>
        <button class="btn secondary" id="loginBtn" type="button">Log in</button>
        <a class="btn secondary small" href="mailto:support@YOURDOMAIN.com?subject=ZenCards%20Cancel%20Subscription">Manage / Cancel subscription</a>
      </div>

      <div class="fineprint">
        <strong>Billing:</strong> Your 7-day free trial starts when you create an account.
        You will be <strong>charged $9.99/month automatically</strong> at the end of the trial unless you cancel beforehand.
        Cancel anytime from the “Manage / Cancel subscription” option.
      </div>
    </div>

    <!-- BENEFITS -->
    <div class="card">
      <h2>Why ZenCards works</h2>
      <div class="grid3">
        <div class="feature">
          <h3>Save time (seriously)</h3>
          <p>
            Most students have 2–3 hours/day of “dead time” (walking, commuting, waiting, chores).
            ZenCards turns that into review time — without sacrificing your life.
          </p>
        </div>
        <div class="feature">
          <h3>More freedom outside school</h3>
          <p>
            Extra hours each day can mean a part-time (or even full-time) job, more time with friends/family,
            or committing fully to a sport or club.
          </p>
        </div>
        <div class="feature">
          <h3>Better memory with audio + speaking</h3>
          <p>
            Hearing information and saying answers out loud boosts recall (often called the <em>production effect</em>).
            Seeing + hearing together supports <em>dual coding</em> so the same study time goes further.
          </p>
        </div>
      </div>

      <div class="grid3" style="margin-top:0.75rem;">
        <div class="feature">
          <h3>Spaced repetition built in</h3>
          <p>
            ZenCards schedules reviews so you see cards again right before you forget — the core idea behind spaced repetition.
            You waste less time re-studying what you already know.
          </p>
        </div>
        <div class="feature">
          <h3>Raise grades → open doors</h3>
          <p>
            Better retention can translate to better exam performance — helping you compete for internships,
            grad school admissions, and stronger early-career opportunities.
          </p>
        </div>
        <div class="feature">
          <h3>Works everywhere</h3>
          <p>
            Study in the car (passenger), walking to class, at the gym between sets, running errands, or between lectures.
            If you can listen, you can review.
          </p>
        </div>
      </div>
    </div>

    <!-- HOW IT WORKS -->
    <div class="card">
      <h2>How it works</h2>
      <div class="row">
        <div>
          <h3 style="margin-top:0;">1) Add cards</h3>
          <p class="muted">
            Create decks, add questions + answers, or import from Anki.
            (You can also include images + math.)
          </p>

          <h3>2) Choose your study style</h3>
          <p class="muted" style="margin-bottom:0.35rem;">
            ZenCards supports multiple hands-free behaviors:
          </p>
          <ul>
            <li><strong>Play answer after you speak</strong> (hands-free flow)</li>
            <li><strong>Play answer after X seconds</strong> (timed flow)</li>
            <li><strong>Automatic mode</strong>: auto-assign the same rating to every card (no voice commands needed)</li>
            <li><strong>Study-ahead mode</strong>: keep going through the deck without changing your schedule</li>
          </ul>
        </div>

        <div>
          <h3 style="margin-top:0;">3) Rate the card (spaced repetition)</h3>
          <p class="muted">
            After you see the answer, you rate it:
            <strong>Again / Hard / Good / Easy</strong>. ZenCards uses that rating to schedule when you see it next.
          </p>

          <div class="note" style="margin-top:0.75rem;">
            <strong>Pro tip:</strong> Use hands-free mode while moving, then do quick silent sessions when you’re sitting.
            Same decks, same progress.
          </div>
        </div>
      </div>
    </div>

    <!-- PRICING -->
    <div class="card">
      <h2>Pricing</h2>
      <div class="pricing">
        <div class="priceCard">
          <span class="badge">Most popular</span>
          <h3 style="margin:0.35rem 0 0 0;">ZenCards Premium</h3>
          <p class="price">$9.99<span style="font-size:0.9rem;font-weight:700;color:var(--muted);">/month</span></p>
          <p class="muted" style="margin-top:0.25rem;">
            Start with a <strong>7-day free trial</strong>, then auto-renews monthly.
          </p>
          <ul>
            <li>Hands-free voice study</li>
            <li>Timed answer mode</li>
            <li>Automatic rating mode</li>
            <li>Study-ahead mode</li>
            <li>Deck + card editor</li>
            <li>Anki import support</li>
          </ul>

          <div class="row" style="margin-top:0.85rem;">
            <a class="btn" href="app.html?startTrial=1">Start free trial</a>
            <button class="btn secondary" id="loginBtn2" type="button">Log in</button>
          </div>

          <div class="fineprint">
            <strong>Auto-billing notice:</strong> After 7 days, you will be charged $9.99/month unless you cancel.
            Cancel anytime before the trial ends to avoid being charged.
          </div>
        </div>

        <div class="priceCard">
          <h3 style="margin-top:0.35rem;">Cancel anytime</h3>
          <p class="muted">
            We keep cancellation simple. Use the button below (you’ll later connect it to Stripe’s customer portal),
            or email support and we’ll handle it.
          </p>

          <a class="btn secondary" href="mailto:support@YOURDOMAIN.com?subject=ZenCards%20Cancel%20Subscription">
            Manage / Cancel subscription
          </a>

          <div class="fineprint">
            <strong>Note:</strong> This landing page is static. The actual cancellation portal link will be added once
            Stripe billing is connected.
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="card faq">
      <h2>FAQ</h2>

      <details>
        <summary>Will I be charged automatically after the free trial?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Yes. Your trial lasts 7 days. If you don’t cancel before it ends, your subscription will begin at
          <strong>$9.99/month</strong> and renew automatically each month until you cancel.
        </p>
      </details>

      <details>
        <summary>How do I cancel?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          You’ll cancel from the “Manage / Cancel subscription” link (Stripe customer portal) once billing is connected.
          For now, you can cancel by emailing <strong>support@YOURDOMAIN.com</strong>.
        </p>
      </details>

      <details>
        <summary>Can I study on my phone and on the website with one subscription?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Yes — one account, one subscription. Log in with the same email and your access follows your account.
        </p>
      </details>

      <details>
        <summary>What’s spaced repetition?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          Spaced repetition is a study method where you review information at increasing intervals,
          timed around when you’re most likely to forget. It’s designed to maximize long-term retention
          while minimizing wasted review time.
        </p>
      </details>

      <details>
        <summary>What are “production effect” and “dual coding”?</summary>
        <p class="muted" style="margin:0.5rem 0 0 0;">
          In simple terms: memory is stronger when you engage multiple channels.
          Speaking responses out loud can reinforce recall (often referred to as the production effect),
          and combining visual + audio supports dual coding — giving your brain more “handles” to retrieve the info later.
        </p>
      </details>
    </div>

    <p class="footer">
      © <span id="year"></span> ZenCards • <span class="muted">Study smarter. Live more.</span>
    </p>
  </div>

  <!-- ===== Login Modal (MOVED ABOVE SCRIPTS so JS can find it) ===== -->
  <div class="modalOverlay" id="loginModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="modalHeader">
        <div>
          <h3 id="loginTitle">Log in</h3>
          <div class="muted" style="font-size:0.9rem;">Enter your ZenCards email + password.</div>
        </div>
        <button class="modalClose" id="loginCloseBtn" type="button">✕</button>
      </div>

      <div class="field">
        <label class="muted" for="loginEmail">Email</label>
        <input class="input" id="loginEmail" type="email" autocomplete="email" placeholder="you@example.com" />
      </div>

      <div class="field">
        <label class="muted" for="loginPassword">Password</label>
        <input class="input" id="loginPassword" type="password" autocomplete="current-password" placeholder="Your password" />
      </div>

      <div class="modalActions">
        <button class="btn" id="loginSubmitBtn" type="button">Log in</button>
        <button class="btn secondary" id="loginCancelBtn" type="button">Cancel</button>
      </div>

      <div class="modalMsg" id="loginMsg"></div>

      <div style="margin-top:0.75rem;">
        <button class="smallLink" id="forgotPwBtn" type="button">Forgot password?</button>
      </div>
    </div>
  </div>

  <!-- ===== Billing Modal (shown after login if no subscription yet) ===== -->
<div class="modalOverlay" id="billingModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="billingTitle">
    <div class="modalHeader">
      <div>
        <h3 id="billingTitle">ZenCards Premium</h3>
        <div class="muted" style="font-size:0.9rem;">
          Your account is ready. Continue to Stripe to start your free trial.
        </div>
      </div>
      <button class="modalClose" id="billingCloseBtn" type="button">✕</button>
    </div>

    <div class="modalActions" style="margin-top:1rem;">
      <button class="btn" id="continueToBillingBtn" type="button">Continue to billing</button>
      <button class="btn secondary" id="billingCancelBtn" type="button">Cancel</button>
    </div>

    <div class="modalMsg" id="billingMsg"></div>
  </div>
</div>


  <script>
    // Year (keep only one)
    document.getElementById("year").textContent = String(new Date().getFullYear());

    // ===== Supabase client (same anon key as app.html) =====
    const SUPABASE_URL = "https://elpfcnnrripftxoqeckv.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVscGZjbm5ycmlwZnR4b3FlY2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NTk5MzQsImV4cCI6MjA4MDQzNTkzNH0.uiLHVcRfMXu0V7QRW41TARMIy-Hbhovc4h9uYFzzGLQ";
    const { createClient } = window.supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    storage: window.localStorage,
  },
});
// ===== Auth status bar (logged-in email) =====
function getStoredSession() {
  const authKey = Object.keys(localStorage).find(k => k.endsWith("-auth-token"));
  const raw = authKey ? localStorage.getItem(authKey) : null;
  if (!raw) return null;
  try { return JSON.parse(raw); } catch { return null; }
}

function renderAuthStatusBar() {
  const s = getStoredSession();

  const bar = document.getElementById("authStatusBar");
  const emailEl = document.getElementById("authEmail");

  const email = s?.user?.email;
  const hasToken = !!s?.access_token;
  const loggedIn = !!(email && hasToken);

  // Optional: hide login buttons when logged in
  const b1 = document.getElementById("loginBtn");
  const b2 = document.getElementById("loginBtn2");
  if (b1) b1.style.display = loggedIn ? "none" : "";
  if (b2) b2.style.display = loggedIn ? "none" : "";

  if (loggedIn) {
    emailEl.textContent = `Logged in as ${email}`;
    bar.style.display = "block";
  } else {
    bar.style.display = "none";
  }
}

// Keep it updated on load + whenever auth changes
renderAuthStatusBar();

supabaseClient.auth.onAuthStateChange((_event, _session) => {
  // session can be null; we re-check localStorage for consistency on static sites
  renderAuthStatusBar();
});

// Logout button
document.getElementById("logoutBtn").addEventListener("click", async () => {
  try { await supabaseClient.auth.signOut(); } catch (e) {}
  // Your app stores other stuff in localStorage (srsDecks, srsSchedule).
  // Remove ONLY the Supabase auth key so you don't wipe user study data.
  const authKey = Object.keys(localStorage).find(k => k.endsWith("-auth-token"));
  if (authKey) localStorage.removeItem(authKey);
  location.reload();
});
    
    // Expose it on window so it's not "undefined" in console
window.startFreeTrial = async function startFreeTrial() {
  const authKey = Object.keys(localStorage).find(k => k.endsWith("-auth-token"));
  const raw = authKey ? localStorage.getItem(authKey) : null;
  const session = raw ? JSON.parse(raw) : null;

  // If already logged in, start Stripe checkout immediately
  if (session?.access_token) {
    await startCheckoutFromLanding();
    return;
  }

  // Otherwise open login modal first
  openLoginModal();
};

    // ===== Login modal logic =====
    const loginModal = document.getElementById("loginModal");
    const loginBtn = document.getElementById("loginBtn");
    const loginBtn2 = document.getElementById("loginBtn2");
    const loginCloseBtn = document.getElementById("loginCloseBtn");
    const loginCancelBtn = document.getElementById("loginCancelBtn");
    const loginSubmitBtn = document.getElementById("loginSubmitBtn");
    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginMsg = document.getElementById("loginMsg");
    const forgotPwBtn = document.getElementById("forgotPwBtn");
        // ===== Billing modal logic =====
    const billingModal = document.getElementById("billingModal");
    const billingCloseBtn = document.getElementById("billingCloseBtn");
    const continueToBillingBtn = document.getElementById("continueToBillingBtn");
    const billingCancelBtn = document.getElementById("billingCancelBtn");
    const billingMsg = document.getElementById("billingMsg");

    function openBillingModal(){
      billingMsg.textContent = "";
      billingMsg.className = "modalMsg";
      billingModal.classList.add("show");
    }
    function closeBillingModal(){
      billingModal.classList.remove("show");
    }

    billingCloseBtn.addEventListener("click", closeBillingModal);
    billingCancelBtn.addEventListener("click", async () => {
      // Optional but recommended: sign out so they don't sit logged-in with no access
      try { await supabaseClient.auth.signOut(); } catch(e) {}
      closeBillingModal();
      window.location.href = "/"; // back to landing
    });

    // close modal if click outside
    billingModal.addEventListener("click", (e) => {
      if (e.target === billingModal) closeBillingModal();
    });

window.addEventListener("unhandledrejection", (e) => {
  console.error("[unhandledrejection]", e.reason);
});
window.addEventListener("error", (e) => {
  console.error("[window error]", e.message, e.error);
});

    continueToBillingBtn.addEventListener("click", async () => {
      console.log("[Billing] click fired");
console.log("[Billing] about to call startCheckoutFromLanding");
setTimeout(() => console.log("[Billing] still running after 5s"), 5000);
      continueToBillingBtn.disabled = true;
      continueToBillingBtn.textContent = "Redirecting…";
      billingMsg.textContent = "";

      try {
        await startCheckoutFromLanding();
      } catch (e) {
        console.error(e);
        billingMsg.textContent = "Could not start billing. Check console.";
        billingMsg.className = "modalMsg error";
        continueToBillingBtn.disabled = false;
        continueToBillingBtn.textContent = "Continue to billing";
      }
    });

    function openLoginModal(){
      loginMsg.textContent = "";
      loginMsg.className = "modalMsg";
      loginModal.classList.add("show");
      setTimeout(() => loginEmail.focus(), 50);
    }
    function closeLoginModal(){
      loginModal.classList.remove("show");
    }

    loginBtn?.addEventListener("click", openLoginModal);
    loginBtn2?.addEventListener("click", openLoginModal);
    loginCloseBtn.addEventListener("click", closeLoginModal);
    loginCancelBtn.addEventListener("click", closeLoginModal);

    // close modal if click outside
    loginModal.addEventListener("click", (e) => {
      if (e.target === loginModal) closeLoginModal();
    });

    // Enter-to-submit
    [loginEmail, loginPassword].forEach(el => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter") loginSubmitBtn.click();
        if (e.key === "Escape") closeLoginModal();
      });
    });

    loginSubmitBtn.addEventListener("click", async () => {
      const email = (loginEmail.value || "").trim();
      const password = loginPassword.value || "";

      if (!email || !password) {
        loginMsg.textContent = "Please enter your email and password.";
        loginMsg.className = "modalMsg error";
        return;
      }

      loginSubmitBtn.disabled = true;
      loginSubmitBtn.textContent = "Logging in…";
      loginMsg.textContent = "";

      try {
        const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
        if (error) {
          loginMsg.textContent = error.message || "Login failed.";
          loginMsg.className = "modalMsg error";
          return;
        }

                loginMsg.textContent = "Logged in ✅";
        loginMsg.className = "modalMsg ok";

        // Close login modal and show billing choices instead of going to app.html
        closeLoginModal();
setTimeout(() => openBillingModal(), 50);

      } catch (e) {
        console.error(e);
        loginMsg.textContent = "Something went wrong. Check console.";
        loginMsg.className = "modalMsg error";
      } finally {
        loginSubmitBtn.disabled = false;
        loginSubmitBtn.textContent = "Log in";
      }
    });

    forgotPwBtn.addEventListener("click", async () => {
      const email = (loginEmail.value || "").trim();
      if (!email) {
        loginMsg.textContent = "Enter your email above first, then click “Forgot password?”.";
        loginMsg.className = "modalMsg error";
        return;
      }

      try {
        const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
          redirectTo: "https://zencardstudy.com/reset.html"
        });
        if (error) {
          loginMsg.textContent = error.message || "Could not send reset email.";
          loginMsg.className = "modalMsg error";
          return;
        }
        loginMsg.textContent = "Password reset email sent ✅";
        loginMsg.className = "modalMsg ok";
      } catch (e) {
        console.error(e);
        loginMsg.textContent = "Reset failed. Check console.";
        loginMsg.className = "modalMsg error";
      }
    });
    
async function startCheckoutFromLanding() {
  console.log("3) inside startCheckoutFromLanding");

  // Pull the auth token directly from localStorage (most reliable on static sites)
  const authKey = Object.keys(localStorage).find(k => k.endsWith("-auth-token"));
  const raw = authKey ? localStorage.getItem(authKey) : null;
  const session = raw ? JSON.parse(raw) : null;

  console.log("4) authKey:", authKey);
  console.log("5) has access_token:", !!session?.access_token);

  if (!session?.access_token) {
    throw new Error("No session token found. Please log in again.");
  }

  console.log("6) calling create-checkout-session");

  const res = await fetch(
    "https://elpfcnnrripftxoqeckv.supabase.co/functions/v1/create-checkout-session",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${session.access_token}`,
        "apikey": SUPABASE_ANON_KEY,
      },
      body: JSON.stringify({
        success_url: "https://zencardstudy.com/app.html",
        cancel_url: "https://zencardstudy.com/?canceled=1",
      }),
    }
  );

  const text = await res.text();
  console.log("7) status:", res.status);
  console.log("8) response text:", text);

  let json;
  try { json = JSON.parse(text); } catch { json = {}; }

  if (!res.ok) {
    throw new Error(json.error || json.message || "Checkout failed");
  }

  if (!json.url) {
    throw new Error("No checkout URL returned from Edge Function");
  }

  window.location.href = json.url;
}

  document.getElementById("startTrialBtn")
  .addEventListener("click", () => window.startFreeTrial());
  </script>

</body>
</html>
